<!--

  begin member area sign in dialog change
  
  License      : < https://bit.ly/3F8sn8W >
  
  Version      : 0.4.0
  
  SS Version   : 7.1
  
  Fluid
  Engine
  Compatible   : Not Applicable
  
  Dependencies : jQuery
  
  By           : Thomas Creedon < http://www.tomsWeb.consulting/ >
  
  -->
  
  <x-twc-masidc-style style="display : none;">
  
    [enter css here between single quotes replacing square brackets]
    
    </x-twc-masidc-style>
    
  <script>
  
    if ( window.twc == undefined ) window.twc = { };
    
    twc.masidc = {
    
      /*
      
        leaving title unaltered tells the code not to make a change to the title
        
        */
        
      title : '[enter title text here between single quotes replacing square brackets]',
      
      /*
      
        accountFrameCallback is a custom function that can be used for further
        customization of the sign in dialog. replace undefined with the
        name of your custom function
        
        your callback must accept a document object. i suggest using dcmnt as
        the parameter to remind you that you are working with a document object
        but not the usual document you may be familiar with. otherwise in most
        cases you can use dcmnt in place of document. they both pretty much have
        the same behaviour
        
        */
        
      accountFrameCallback : undefined
      
      };
      
    </script>
    
  <!-- do not change anything below, there be the borg here -->
  
  <script>
  
    $( ( ) => {
    
      // bail if no mutation observer available
      
      if ( ! ( 'MutationObserver' in window ) ) return;
      
      const accountFrameIdValue = 'accountFrame';
      
      const load = ( $element ) => {
      
        const css = document
        
          .getElementsByTagName ( 'x-twc-masidc-style' )
          
          [ 0 ];
          
        const data = { css : css };
        
        $element.on ( 'load', data, function ( event ) {
        
          const pathname = this
          
            .contentWindow
            
            .location
            
            .pathname;
            
          const b = pathname.startsWith ( '/account/frame/login' );
          
          if ( ! b ) return; // bail if not sign in
          
          const dcmnt = this.contentDocument;
          
          const id = 'user-account-login-root';
          
          const callback = mutations => {
          
            mutations.forEach ( mutation => {
            
              // bail if no nodes added
              
              if ( ! mutation.addedNodes.length ) return;
              
              const node = mutation.addedNodes [ 0 ];
              
              let selector = 'button[type="submit"]' +
              
                '[data-test="login-button"]';
                
              const isSignIn = node.querySelector ( selector ) != null;
              
              if ( ! isSignIn ) return; // bail if not sign up
              
              const callback = mutations => {
              
                mutations.forEach ( mutation => {
                
                  // bail if attribute not class
                  
                  if ( mutation.attributeName != 'class' ) return;
                  
                  const element = mutation.target;
                  
                  const className = element
                    
                    .getAttribute ( attributeNameClass );
                    
                  // bail data class attribute is null
                  
                  if ( className == null ) return;
                  
                  const b = element
                  
                    .classList
                    
                    .contains ( className );
                    
                  // bail class already added
                  
                  if ( b ) return;
                  
                  element
                  
                    .classList
                    
                    .add ( className );
                    
                  } );
                  
                }; // end mutations
                
              const codeClassName = 'twc-masidc';
              
              const classAdd = ( key ) => {
            
                const selector = `[ href="/account/login/${ key }" ]`;
              
                const element = dcmnt.querySelector ( selector );
              
                if ( element != null )
              
                  element.classList.add ( `${ codeClassName }-${ key }` );
                
                return element;
              
                };
              
              const config = {
              
                attributes : true,
                subtree : true
                
                };
                
              const observer = new MutationObserver ( callback );
              
              const options = twc.masidc;
              
              const accountFrameCallback = options.accountFrameCallback;
              
              const attributeNameClass = `data-${ codeClassName }-class`;
              
              let element;
              
              // begin add css
              
                let p = new RegExp ( '^\s+\[.+\]\s+$' );
                
                let s = event
                
                  .data
                  
                  .css
                  
                  .textContent;
                  
                let add = ! p.test ( s );
                
                if ( add ) {
                
                  const style = dcmnt.createElement ( 'style' );
                  
                  style.textContent = s;
                  
                  dcmnt.body.append ( style );
                  
                  }
                  
                // end add css
                
              // code class add
              
              dcmnt
              
                .getElementById ( `${ id }` )
                
                .classList
                
                .add ( `${ codeClassName }` );
                
              // begin change title
              
                p = new RegExp ( '^\[.+\]$' );
                
                s = options.title;
                
                const changeTitle = ! p.test ( s );
                
                if ( changeTitle ) {
                
                  element = dcmnt
                  
                    .getElementsByTagName ( 'h1' )
                    
                    [ 0 ];
                    
                  element.classList
                  
                    .add ( `${ codeClassName }-title` );
                    
                  element.textContent = s;
                  
                  }
                  
                // end change title
                
              // begin sign in again class add
              
                element = dcmnt
                
                  .getElementsByTagName ( 'h3' )
                  
                  [ 0 ];
                  
                if ( element != null )
                
                  element
                  
                    .classList
                    
                    .add ( `${ codeClassName }-sign-in-again-text` );
                    
                // end sign in again class add
                
              // begin sign in email text class add
              
                let text = 'Sign in with';
                
                element = dcmnt.querySelectorAll ( 'form span' );
                
                element = [ ...element ]
                
                  .filter ( n => n.textContent.startsWith ( text ) )
                  
                  [ 0 ];
                  
                if ( element !== undefined ) {
                
                  s = `${ codeClassName }-sign-in-email-text`;
                  
                  element
                  
                    .parentElement
                    
                    .classList
                    
                    .add ( s );
                    
                  }
                  
                // end sign in email text class add
                
              // begin email class add
              
                let value = `${ codeClassName }-email`;
                
                selector = 'form input[ type="email" ]';
                
                element = dcmnt.querySelector ( selector );
                  
                if ( element != null )
                
                  element
                  
                    .parentElement
                    
                    .parentElement
                    
                    .setAttribute ( attributeNameClass, value );
                    
                // end email class add
                
              // begin password class add
              
                selector = 'form input[ type="password" ]';
                
                value = `${ codeClassName }-password`;
                
                dcmnt
                
                  .querySelector ( selector )
                  
                  .parentElement
                  
                  .parentElement
                  
                  .setAttribute ( attributeNameClass, value );
                  
                // end password class add
                
              element = classAdd ( 'request-reset' );
              
              element = classAdd ( 'create' );
              
              // begin not you class add
              
                selector = 'footer [ href="#" ]';
                
                element = dcmnt.querySelector ( selector );
                
                if ( element != null ) {
                
                  s = `${ codeClassName }-not-you`;
                
                  element
                  
                    .classList
                    
                    .add ( s );
                    
                  }
                  
                // end not you class add
                
              if ( accountFrameCallback !== undefined )
              
                accountFrameCallback ( dcmnt );
                
              // start listening for changes in element
              
              element = dcmnt.querySelector ( 'form' );
              
              observer.observe ( element, config );
              
              } ); // end mutations
              
            };
            
          const config = {
          
            childList : true
            
            };
            
          const observer = new MutationObserver ( callback );
          
          // start listening for changes in specified element
          
          const node = dcmnt
          
            .getElementById ( `${ id }` )
            
            .lastChild;
            
          observer.observe ( node, config );
          
          } ); // end on load
          
        };
        
      const callback = ( mutations ) => {
      
        $.each ( mutations, function ( ) {
        
          if ( ! this.addedNodes.length ) return; // bail if no nodes added
          
          const $element = $( this.addedNodes [ 0 ] );
          
          const id = $element.attr ( 'id' );
          
          // bail if not account frame
          
          if ( id != `${ accountFrameIdValue }` ) return;
          
          load ( $element );
          
          } ); // end mutations
          
        }; // end callback
        
      const config = {
      
        childList : true
        
        };
        
      const observer = new MutationObserver ( callback );
      
      const selector = `#${ accountFrameIdValue }`;
      
      const $element = $( selector );
      
      /*
      
        if the account frame is already on the DOM, load. if not, then watch for
        it to appear on DOM and load
        
        */
        
      if ( $element.length )
      
        load ( $element );
        
      // start listening for changes in specified element
      
      observer.observe ( document.body, config );
      
      } );
      
    </script>
    
  <!-- end member area sign in dialog change -->
