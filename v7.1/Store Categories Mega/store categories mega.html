<!--

  begin store categories mega
  
  License       : < https://bit.ly/3F8sn8W >
  
  Version       : 0.1.1
  
  SS Version    : 7.1
  
  Fluid
  Engine
  Compatible    : Not Applicable
  
  Dependencies  : store categories cache
  
  Note          : the code is comprised of a style and script tag. all are
                  needed for the full effect to work
  
  By            : Thomas Creedon < http://www.tomsWeb.consulting/ >
  
  no user serviceable parts below
  
  -->
  
  <style>
  
    .twc-scm {
    
      --spacing-left : calc( 40px / 2 );
      
      }
      
    /* begin resets */
    
      .products.collection-content-wrapper .nested-category-children {
      
        text-align : left;
        
        }
        
      .products.collection-content-wrapper .nested-category-breadcrumb-list-item .nested-category-breadcrumb-link {
      
        margin : 0;
        
        }
        
      /* end resets */
      
    .products.collection-content-wrapper .nested-category-children .active {
    
      cursor : default;
      text-decoration : unset;
      
      }
      
    .twc-scm summary {
    
      display : list-item;
      
      }
      
    @media screen and ( max-width : 799px ) {
    
      .products.collection-content-wrapper .nested-category-breadcrumb-list-item:not( .children ) .nested-category-breadcrumb-link {

        margin-left : var( --spacing-left );
  
        }

      .twc-scm {
      
        font-size : larger;
        
        }
        
      .twc-scm li:not( :last-child ) {
      
        margin-bottom : 0.5em;
        
        }
        
      .twc-scm summary::marker {
      
        font-size : larger;
        
        }
        
      .twc-scm ul {
      
        padding-inline-start : var( --spacing-left );
        
        }
        
      }
      
    @media screen and ( min-width : 800px ) {
    
      /* begin resets */
      
        .products.collection-content-wrapper .nested-category-breadcrumb-list-item:last-child .breadcrumb-separator {
        
          display : unset;
          
          }
          
        /* end resets */
        
      .twc-scm summary {
        
        margin-bottom : 0.5em;
        
        }
        
      .twc-scm ul {
      
        display : flex;
        flex-wrap : wrap;
        gap : 0.5em;
        
        }
        
      .twc-scm ul ul {
      
        flex-direction : column;
        
        }
        
      .twc-scm .breadcrumb-separator {
      
        margin-left : 1vw;
        
        }
        
      .twc-scm > .nested-category-breadcrumb-list-item > details > summary {
      
        text-align : center;
        
        }

      .twc-scm > .nested-category-breadcrumb-list-item > details > ul {
      
        padding-left : 0;
        
        }

      .products.collection-content-wrapper .nested-category-breadcrumb-list-item:last-child .breadcrumb-separator {
      
        display : unset;
        
        }
        
      .products.collection-content-wrapper .nested-category-breadcrumb-list-item .nested-category-breadcrumb-list-item:last-child .breadcrumb-separator,
      .products.collection-content-wrapper .twc-scm > .nested-category-breadcrumb-list-item .nested-category-breadcrumb-list-item .nested-category-breadcrumb-list-item .breadcrumb-separator,
      .products.collection-content-wrapper .twc-scm > .nested-category-breadcrumb-list-item:last-child > .breadcrumb-separator
      
        {
        
          display : none;
          
          }
          
      }
      
    </style>
    
  <script>
  
    var twcScm = categories => {
    
      const $ul = $( '<ul class="nested-category-children twc-scm"/>' );
      
      const traverse = ( categories, $ul ) => {
      
        $.each ( categories, function ( i, category ) {
        
          const hasChildren = Boolean ( category.children.length );
          
          const $li = $( `
          
            <li class="nested-category-breadcrumb-list-item">
            
              <a class="nested-category-breadcrumb-link" href="${ category.fullUrl }">
              
                ${ category.displayName }
                
                </a>
                
              <span class="breadcrumb-separator" aria-hidden="true">
              
                |
                
                </span>
                
              </li>
              
            ` );
            
          let $element;
          
          if ( hasChildren )
          
            $element = $li
            
              .addClass ( 'children' )
              
              .find ( '.nested-category-breadcrumb-link' )
              
              .wrap ( `
              
                <details/>
                
                  <summary/>
                  
                ` )
                
              .parents ( 'details' );
              
            else
            
              $element = $li;
              
          $ul.append ( $li );
          
          if ( ! hasChildren ) return true; // continue
          
          $childrenUl = $( '<ul/>' )
          
            .appendTo ( $element );
            
          traverse ( category.children, $childrenUl );
          
          } );
          
        };
        
      traverse ( categories, $ul )
      
      let selector = `[href="${ twcsl.page.store.urlSlug }` +
      
        `${ twcsl.page.store.list.categoryUrlSlug }"]`;
        
      $( selector, $ul )
      
        .addClass ( 'active' )
        
        .removeAttr ( 'href' )
        
        .parents ( 'details' )
        
        .attr ( 'open', '' );
        
      if ( twcsl.page.store.list.hasCategory ) {
      
        selector = [
        
        '.nested-category-breadcrumb',
        
        '.nested-category-children',
        
        '.nested-category-title',
        
        ]
        
        .join ( ', ' );
        
        $( selector ).remove ( );
        
        selector = '.products.collection-content-wrapper';
        
        $( selector ).prepend ( $ul );
        
        } else {
        
          selector =
          
            '.products.collection-content-wrapper .nested-category-children';
            
          $( selector ).replaceWith ( $ul );
          
          }
          
      };
      
    </script>
    
  <!-- end store categories mega -->
