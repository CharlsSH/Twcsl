<script>

  document.addEventListener ( 'DOMContentLoaded', ( ) => {
  
    /*
    
      page section info
      
      License     : < https://bit.ly/3F8sn8W >
      
      Version     : 0.2.0
      
      SS Version  : 7.1
      
      Fluid
      Engine
      Compatible  : Not Applicable
      
      Note        : this effect is only active in SS Preview
      
      By          : Thomas Creedon < http://www.tomsWeb.consulting/ >
      
      License     : < https://bit.ly/3Ob7JsO >
      
      no user serviceable parts below
      
      */
      
    // bail if no mutation observer available
    
    if ( ! ( 'MutationObserver' in window ) ) return;
    
    if ( window.frameElement == null ) return; // bail if not in preview
    
    const callback = ( mutations ) => {
    
      mutations.forEach ( mutation => {
      
        if ( ! mutation.addedNodes.length ) return false;
        
        const element = mutation.addedNodes [ 0 ];
        
        let b = element.nodeName != 'DIV';
        
        if ( b ) return true; // continue if not DIV node
        
        let className = 'js-section-editor-ui-container';
        
        const isSectionEditorUi = element
        
          .classList
          
          .contains ( className );
          
        if ( ! isSectionEditorUi ) return; // bail if not section editor ui
        
        const dataSectionId = element
        
          .getAttribute ( 'data-section-id' );
          
        let selector =
        
          `[data-section-id="${ dataSectionId }"]`;
          
        let bodyClasses = document
        
          .body
          
          .classList;
          
        bodyClasses = [ ...bodyClasses ];
        
        let sectionClasses = document
        
          .querySelector ( selector )
          
          .classList;
          
        sectionClasses = [ ...sectionClasses ];
        
        /*
        
        b =
        
          sectionClasses.contains ( 'collection-type-products' ) ||
          
          sectionClasses.contains ( 'gallery-section' ) ||
          
          sectionClasses.contains ( 'user-items-list-section' ) ||
          
          sectionClasses.some ( clss =>
          
            clss.startsWith ( 'collection-type-events-' ) ||
            
            clss.startsWith ( 'collection-type-portfolio-' ) /* || (
            
              clss.startsWith ( 'collection-type-blog-' ) &&
              
              bodyClasses.contains ( 'view-list' )
              
              )
              
            );
            
        if ( b ) return true; // continue if section not of interest
        
        */
        
        const attribute = 'class';
        
        const callback = ( mutations ) => {
        
          mutations.forEach ( mutation => {
          
            // bail if not attribute
            
            if ( mutation.attributeName != attribute ) return;
            
            const target = mutation.target;
            
            let b = target
            
              .classList
              
              .contains ( 'show-toolbar' );
              
            if ( ! b ) return; // bail if not toolbar
            
            const dataSectionId = target
            
              .closest ( '.js-section-editor-ui-container' )
              
              .getAttribute ( 'data-section-id' );
              
            let selector = `[data-section-id="${ dataSectionId }"]`;
            
            const pageSection = document
            
              .querySelector ( selector );
              
            // begin editor
            
              selector = '.twc-psi-data-editor';
              
              let element = toolbar
              
                .querySelector ( selector );
                
              const isClassicEditor = sectionClasses
              
                .contains ( 'layout-engine-section' )
                
                ||
                
                (
                
                  sectionClasses.some ( clss =>
                  
                    clss.startsWith ( 'collection-type-blog-' )
                    
                    )
                    
                  &&
                  
                  bodyClasses.contains ( 'view-item' )
                  
                  )
                  
                ||
                
                (
                
                  sectionClasses.some ( clss =>
                  
                    clss.startsWith ( 'collection-type-events-' )
                    
                    )
                    
                  &&
                  
                  bodyClasses.contains ( 'view-item' )
                  
                  );
                  
              const isFluidEngine = pageSection
              
                .hasAttribute ( 'data-fluid-engine-section' );
                
              b = isFluidEngine || isClassicEditor;
              
              if ( b ) {
              
                let editor = isFluidEngine ? 'Fluid Engine' : 'Classic Editor';
                
                element
                
                  .classList
                  
                  .remove ( 'hide' );
                  
                selector = '.twc-psi-data-data';
                
                element
                
                  .querySelector ( selector )
                  
                  .innerText = editor;
                  
                } else
                
                  element
                  
                    .classList
                    
                    .add ( 'hide' );
                    
              // end editor
              
            // begin type
            
              const isAutoLayout = sectionClasses
              
                .contains ( 'user-items-list-section' );
                
              const isBlank = sectionClasses
              
                .contains ( 'layout-engine-section' );
                
              const isBlog = sectionClasses.some ( clss =>
              
                clss.startsWith ( 'collection-type-blog-' ) &&
                
                bodyClasses.contains ( 'view-list' )
                
                );
                
              const isBlogPost = sectionClasses.some ( clss =>
              
                clss.startsWith ( 'collection-type-blog-' ) &&
                
                bodyClasses.contains ( 'view-item' )
                
                );
                
              const isEvent = sectionClasses.some ( clss =>
              
                clss.startsWith ( 'collection-type-events-' ) &&
                
                bodyClasses.contains ( 'view-item' )
                
                );
                
              const isEvents = sectionClasses.some ( clss =>
              
                clss.startsWith ( 'collection-type-events-' ) &&
                
                bodyClasses.contains ( 'view-list' )
                
                );
                
              const isGallery = sectionClasses
              
                .contains ( 'gallery-section' );
                
              const isPortfolio = sectionClasses.some ( clss =>
              
                clss.startsWith ( 'collection-type-portfolio-' )
                
                );
                
              const isStore = sectionClasses
              
                .contains ( 'collection-type-products' );
                
              const isVideo = sectionClasses
              
                .contains ( 'lessons-item-section' );
                
              selector = '#video-gallery-main-content';
              
              const isVideos = pageSection
                
                  .querySelector ( selector )
                  
                  !=
                  
                  null;
                  
              selector = '.twc-psi-data-type';
              
              element = toolbar
              
                .querySelector ( selector );
                
              let type;
              
              switch ( true ) {
              
                case isAutoLayout :
                
                  type = 'Auto Layout';
                  
                  break;
                  
                case isBlank :
                
                  type = 'Blank';
                  
                  break;
                  
                case isBlog :
                
                  type = 'Blog';
                  
                  break;
                  
                case isBlogPost :
                
                  type = 'Blog Post';
                  
                  break;
                  
                case isEvent :
                
                  type = 'Event';
                  
                  break;
                  
                case isEvents :
                
                  type = 'Events';
                  
                  break;
                  
                case isGallery :
                
                  type = 'Gallery';
                  
                  break;
                  
                case isPortfolio :
                
                  type = 'Portfolio';
                  
                  break;
                  
                case isStore :
                
                  type = 'Store';
                  
                  break;
                  
                case isVideo :
                
                  type = 'Video';
                  
                  break;
                  
                case isVideos :
                
                  type = 'Videos';
                  
                  break;
                  
                }
                
              if ( type ) {
              
                selector = '.twc-psi-data-data';
                
                element
                
                  .classList
                  
                  .remove ( 'hide' );
                  
                element
                
                  .querySelector ( selector )
                  
                  .innerText = type;
                  
                } else {
                
                  element
                  
                    .classList
                    
                    .add ( 'hide' );
                    
                  }
                  
              // end type
              
            // begin block count
            
              selector = '.sqs-block';
                
              const blockCount = pageSection
              
                .querySelectorAll ( selector )
                
                .length;
                
              selector = '.twc-psi-data-blocks-number';
              
              element = toolbar
              
                .querySelector ( selector );
                
              if ( blockCount ) {
              
                selector = '.twc-psi-data-data';
                
                element
                
                  .classList
                  
                  .remove ( 'hide' );
                  
                element
                
                  .querySelector ( selector )
                  
                  .innerText = blockCount;
                  
                } else {
                
                  element
                  
                    .classList
                    
                    .add ( 'hide' );
                    
                  }
                  
              // end block count
              
            } );
            
          };
          
        const config = {
        
          attributeFilter : [ attribute ],
          
          attributeOldValue : true,
          
          childList : true
          
          };
          
        const observer = new MutationObserver ( callback );
        
        let template =
        
          `
          
            <div class="twc-psi-info">
            
              <div class="twc-psi-title">
              
                Info
                
                </div>
                
              <table class="twc-psi-data">
              
                <tbody>
                
                  <tr class="item twc-psi-data-editor">
                  
                    <td class="twc-psi-data-title">
                    
                      Editor
                      
                      </td>
                      
                    <td class="twc-psi-data-data">
                    
                      </td>
                      
                    </tr>
                    
                  <tr class="item twc-psi-data-type">
                  
                    <td class="twc-psi-data-title">
                    
                      Type
                      
                      </td>
                      
                    <td class="twc-psi-data-data">
                    
                      </td>
                      
                    </tr>
                    
                  <tr class="item twc-psi-data-blocks-number">
                  
                    <td class="twc-psi-data-title">
                    
                      Blocks
                      
                      </td>
                      
                    <td class="twc-psi-data-data">
                    
                      </td>
                      
                    </tr>
                    
                  </tbody>
                  
                </div>
                
              </table>
              
              `;
              
        template = new DOMParser ( )
        
          .parseFromString ( template, 'text/html' );
        
        template = template.body.firstChild
        
        selector = 'js-section-toolbar';
        
        const toolbar = element
        
          .getElementsByClassName ( selector )
          
          [ 0 ];
          
        const hasInfo = toolbar
        
          .querySelector ( '.twc-psi-info' )
          
          !=
          
          null;
          
        if ( ! hasInfo )
        
          toolbar.append ( template );
          
        selector = 'sqs-section-editing-ui';
        
        const editingUi = element
        
          .getElementsByClassName ( selector )
          
          [ 0 ];
          
        // start listening for changes in editor ui
        
        observer.observe ( editingUi, config );
        
        } );
        
      }; // end callback
      
    const config = {
    
      childList : true,
      
      subtree : true
      
      };
      
    const observer = new MutationObserver ( callback );
    
    const parentDocument = parent.document;
    
    const style = parentDocument.createElement ( 'style' );
    
    style.setAttribute ( 'type', 'text/css' );
    
    style.innerHTML = `
    
      .twc-psi-info {
      
        -webkit-box-sizing : border-box;
        box-sizing : border-box;
        
        border : 1px solid rgb( 231, 231, 231 );
        border-radius : 4px;
        
        display : -webkit-box;
        display : -ms-flexbox;
        display : flex;
        
        -webkit-box-orient : vertical;
        -webkit-box-direction : normal;
        -ms-flex-direction : column;
        flex-direction : column;
        
        gap : 4px;
        padding : 4px;
        
        }
        
      .twc-psi-info .twc-psi-title {
      
        font-size : smaller;
        font-weight : bold;
        text-align : center;
        text-transform : uppercase;
        width : 100%;
        
        }
        
      .twc-psi-info .twc-psi-data {
      
        padding: 10px 8px;
        
        }
        
      .twc-psi-data .item.hide {
      
        display : none;
        
        }
        
      .twc-psi-data-title {
      
        font-weight : bold;
        width : 1%;
        
        }
        
      td.twc-psi-data-data::before {
      
        content : ':';
        margin-left : 0.5em;
        margin-right : 0.5em;
        
        }
        
      `;
      
    parentDocument
    
      .head
      
      .appendChild ( style );
      
    // start listening for changes in parent document body
    
    observer.observe ( parentDocument.body, config );
    
    } );
    
  </script>
