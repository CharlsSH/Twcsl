<script>

  $( ( ) => {
  
    /*
    
      begin menu mobile outline
      
      License       : < https://bit.ly/3F8sn8W >
      
      Version       : 0.2.2
      
      SS Version    : 7.1
      
      Fluid
      Engine
      Compatible    : Not Applicable
      
      Dependencies  : jQuery
      
      By            : Thomas Creedon < http://www.tomsWeb.consulting/ >
      
      no user serviceable parts below
      
      */
    
    const build = ( ) => {
    
      const $menu = $( '<ul class="twc-mmo-outline">' );
      
      const $navigation = $( '.header-menu .header-menu-nav-list' );
      
      selector = `${ rootSelector } .header-menu-nav-item a`;
      
      $( selector, $navigation ).each ( function ( ) {
      
        let $this = $( this );
        
        const dataFolderId = $this.attr ( 'data-folder-id' );
        
        const isFolder = dataFolderId === undefined ? false : true;
        
        $( '.chevron', $this ).remove ( );
        
        const isUserAccounts = $this.hasClass ( 'user-accounts-text-link' );
        
        if ( isUserAccounts )
        
          $this = $this.parent ( );
          
        const $li = $( '<li class="header-menu-nav-item">' )
        
          .append ( $this );
          
        if ( isFolder ) {
        
          const $ul = $( '<ul>' );
          
          selector = `[data-folder="${ dataFolderId }"] ` +
          
            '.header-menu-nav-item:not( .header-menu-controls ) a';
            
          $( selector, $navigation ).each ( function ( ) {
          
            const $this = $( this );
            
            $( '<li class="header-menu-nav-item">' )
            
              .append ( $this )
              
              .appendTo ( $ul );
              
            } );
            
          $li.append ( $ul );
          
          }
          
        $li.appendTo ( $menu );
        
        } );
        
      $navigation
      
        .find ( `[data-folder]:not( ${ rootSelector } )` )
        
          .remove ( )
          
          .end ( )
          
        .find ( '.header-menu-nav-folder-content' )
        
          .replaceWith ( $menu );
          
      };
      
    const clssActive = 'header-menu-nav-folder--active';
    
    const rootSelector = '[data-folder="root"]';
    
    let selector = `${ rootSelector }.header-menu-nav-folder`;
    
    let $element = $( selector );
    
    const isActive = $element.hasClass ( clssActive );
    
    if ( isActive )
    
      build ( );
      
      else {
      
        const callback = ( mutations ) => {
        
          $.each ( mutations, function ( ) {
          
            // continue if not class
            
            if ( this.attributeName != 'class' ) return true;
            
            $element = $( this.target );
            
            b = $element.hasClass ( clssActive );
            
            if ( ! b ) return true; // continue if no active class
            
            observer.disconnect ( );
            
            build ( );
            
            return false;
            
            } );
            
          }; // end callback
          
        const config = {
        
          attributes : true
          
          };
          
        const observer = new MutationObserver ( callback );
        
        // start listening for changes in element
        
        const element = $element.get ( 0 );
        
        observer.observe ( element, config );
        
        }
        
    } );
    
  </script>
